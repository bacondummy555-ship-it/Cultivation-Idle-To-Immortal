<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path to Immortality - Modular UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --realm-color: #4c1d95; --glow: rgba(139, 92, 246, 0.5); --lightning-color: #fff; }
        body { background-color: #050507; color: #e2e8f0; font-family: 'Georgia', serif; overflow-x: hidden; }
        
        /* Modular Profile Icon Component */
        .profile-container { position: relative; width: 100px; height: 100px; }
        
        .profile-frame { 
            position: relative; 
            width: 80px; height: 80px; 
            border-radius: 50%; 
            border: 3px solid var(--realm-color); 
            box-shadow: 0 0 20px var(--realm-color), inset 0 0 15px var(--realm-color);
            z-index: 10; background: #000;
        }

        .profile-aura { 
            position: absolute; inset: -10px; border-radius: 50%; 
            background: radial-gradient(circle, var(--realm-color) 0%, transparent 70%);
            opacity: 0.3; animation: pulse-aura 3s infinite ease-in-out; z-index: 5;
        }

        /* Tribulation Lightning Effect */
        #lightning-canvas {
            position: absolute; inset: -20px; width: 140px; height: 140px;
            pointer-events: none; z-index: 20; opacity: 0;
        }
        .lightning-active { opacity: 1 !important; animation: flash 0.2s infinite; }

        @keyframes pulse-aura { 0%, 100% { transform: scale(1); opacity: 0.2; } 50% { transform: scale(1.2); opacity: 0.5; } }
        @keyframes flash { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(2); } }

        /* Draggable Admin Style */
        #admin-panel { position: fixed; z-index: 100; cursor: default; }
        #admin-header { cursor: move; }
        
        .mystic-border { border: 1px solid rgba(255,255,255,0.1); background: rgba(15, 15, 20, 0.9); backdrop-filter: blur(12px); }
        .qi-gradient { background: linear-gradient(90deg, var(--realm-color), #fff); box-shadow: 0 0 15px var(--realm-color); }
    </style>
</head>
<body class="p-6">

    <div id="game-ui" class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 p-6 bg-white/5 rounded-3xl border border-white/10">
            
            <div class="flex items-center gap-6">
                <div class="profile-container">
                    <div id="profile-aura-effect" class="profile-aura"></div>
                    <svg id="lightning-canvas" viewBox="0 0 100 100">
                        <path id="lightning-path" d="" stroke="white" stroke-width="2" fill="none" />
                    </svg>
                    <div id="profile-frame-el" class="profile-frame flex items-center justify-center overflow-hidden">
                        <span id="sect-emblem" class="text-4xl">‚òØÔ∏è</span>
                    </div>
                    <div id="sect-rank" class="absolute -bottom-1 left-1/2 -translate-x-1/2 bg-purple-900 border border-purple-400 px-3 py-0.5 rounded-full text-[9px] font-bold z-30 whitespace-nowrap uppercase">
                        Outer Disciple
                    </div>
                </div>

                <div class="space-y-1">
                    <div class="flex items-center gap-3">
                        <h1 id="p-name" class="text-3xl font-black text-white tracking-tight">...</h1>
                        <span id="karma-tag" class="px-2 py-0.5 rounded text-[10px] font-bold">NEUTRAL</span>
                    </div>
                    <div class="flex flex-col">
                        <span id="p-realm" class="text-yellow-400 font-bold tracking-[0.2em] uppercase text-xs">Mortal</span>
                        <div class="flex gap-4 text-[10px] font-mono text-gray-500 mt-1">
                            <span id="p-uid">UID: ---</span>
                            <span id="dao-path" class="text-blue-400">PATH: BALANCE</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-10">
                <div class="text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-bold">Qi Capacity</p>
                    <p id="qi-val" class="text-2xl font-mono font-bold">0</p>
                </div>
                <div class="text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-bold">Lifespan</p>
                    <p class="text-2xl font-mono"><span id="age">18</span>/<span id="maxAge">100</span></p>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div class="mystic-border h-96 rounded-3xl flex flex-col items-center justify-center relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-purple-900/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <button onclick="game.manualMeditate()" class="relative z-10 w-48 h-48 rounded-full border-2 border-white/10 flex items-center justify-center bg-black/40 hover:scale-105 transition-all active:scale-95">
                        <div class="text-center">
                            <p class="text-purple-400 font-black text-xl">MEDITATE</p>
                            <p class="text-[10px] text-gray-500">GATHER QI</p>
                        </div>
                    </button>
                    
                    <button id="break-btn" onclick="game.breakthrough()" class="hidden absolute bottom-10 px-12 py-4 bg-yellow-500 text-black font-black rounded-full shadow-[0_0_30px_#eab308] animate-bounce">
                        ATTEMPT BREAKTHROUGH
                    </button>
                </div>
                <div id="log" class="mystic-border p-6 rounded-2xl h-40 overflow-y-auto font-mono text-xs text-gray-400 space-y-1"></div>
            </div>

            <div class="space-y-6">
                <div class="mystic-border p-6 rounded-2xl">
                    <h3 class="text-xs font-bold text-gray-500 uppercase mb-4">Progression</h3>
                    <div class="w-full bg-black h-2 rounded-full overflow-hidden mb-2">
                        <div id="qi-bar" class="qi-gradient h-full w-0 transition-all"></div>
                    </div>
                    <p class="text-[10px] text-right text-gray-500" id="qi-percent">0% to next Realm</p>
                </div>
            </div>
        </div>

        <div id="admin-panel" class="hidden bg-red-950/90 border border-red-500 w-64 rounded-xl shadow-2xl overflow-hidden" style="top: 20px; right: 20px;">
            <div id="admin-header" class="bg-red-600 p-2 text-[10px] font-black uppercase text-center text-white">Heavenly Overseer (Drag Me)</div>
            <div class="p-4 space-y-2">
                <button onclick="game.state.qi += 10000; game.render();" class="w-full py-2 bg-white/10 hover:bg-white/20 text-[10px] font-bold rounded">INSTANT QI (10K)</button>
                <button onclick="game.state.karma += 5000" class="w-full py-2 bg-green-600 text-[10px] font-bold rounded">ADD GOOD KARMA</button>
                <button onclick="game.state.karma -= 5000" class="w-full py-2 bg-red-600 text-[10px] font-bold rounded">ADD EVIL KARMA</button>
            </div>
        </div>
    </div>

    <script type="module">
        // CONFIG OBJECTS (Data-Driven)
        const UI_ENUMS = {
            KARMA_TYPES: {
                EVIL: { label: 'DEMONIC', style: 'bg-red-900/50 text-red-400 border-red-500' },
                NEUTRAL: { label: 'NEUTRAL', style: 'bg-gray-800 text-gray-400 border-gray-600' },
                GOOD: { label: 'DIVINE', style: 'bg-cyan-900/50 text-cyan-400 border-cyan-500' }
            },
            SECTS: [
                { name: "Void Wanderers", emblem: "üåë", rank: "Initiate", min: 0 },
                { name: "Cloud Sword", emblem: "‚öîÔ∏è", rank: "Disciple", min: 3 },
                { name: "Heavenly Throne", emblem: "üëë", rank: "Elder", min: 7 }
            ]
        };

        const game = {
            currentUser: { uid: "GUEST_777", displayName: "Daoist Wanderer" },
            state: {
                name: "Daoist Wanderer", qi: 0, realmIdx: 0, age: 18, maxAge: 100,
                karma: 0, technique: "dao", lastTick: Date.now()
            },
            realms: [
                { name: "Mortal Root", req: 100, color: "#94a3b8", chance: 0.9 },
                { name: "Qi Gathering", req: 500, color: "#4ade80", chance: 0.7 },
                { name: "Foundation", req: 2500, color: "#3b82f6", chance: 0.5 },
                { name: "Core Formation", req: 10000, color: "#a855f7", chance: 0.3 },
                { name: "Nascent Soul", req: 50000, color: "#f43f5e", chance: 0.15 }
            ],

            init() {
                this.setupDraggable();
                this.startGame();
                // Check for Admin
                if(this.currentUser.uid === "GUEST_777") document.getElementById('admin-panel').classList.remove('hidden');
            },

            startGame() {
                setInterval(() => this.tick(), 100);
            },

            tick() {
                const dt = (Date.now() - this.state.lastTick) / 1000;
                this.state.lastTick = Date.now();
                const rate = Math.pow(2, this.state.realmIdx) * 5;
                const req = this.realms[this.state.realmIdx].req;
                
                if (this.state.qi < req) {
                    this.state.qi += rate * dt;
                }
                this.render();
            },

            render() {
                const r = this.realms[this.state.realmIdx];
                const progress = (this.state.qi / r.req) * 100;

                // Bind Profile Data
                document.getElementById('p-name').innerText = this.state.name;
                document.getElementById('p-realm').innerText = r.name;
                document.getElementById('p-uid').innerText = `UID: ${this.currentUser.uid}`;
                document.getElementById('qi-val').innerText = Math.floor(this.state.qi).toLocaleString();
                document.getElementById('qi-bar').style.width = `${progress}%`;
                document.getElementById('qi-percent').innerText = `${Math.floor(progress)}% to next Realm`;
                document.documentElement.style.setProperty('--realm-color', r.color);

                // Sect & Karma Binding
                const sect = UI_ENUMS.SECTS.filter(s => this.state.realmIdx >= s.min).pop();
                document.getElementById('sect-emblem').innerText = sect.emblem;
                document.getElementById('sect-rank').innerText = sect.rank;

                const kType = this.state.karma < -100 ? 'EVIL' : (this.state.karma > 100 ? 'GOOD' : 'NEUTRAL');
                const kCfg = UI_ENUMS.KARMA_TYPES[kType];
                const kTag = document.getElementById('karma-tag');
                kTag.innerText = kCfg.label;
                kTag.className = `px-2 py-0.5 rounded text-[10px] font-bold border ${kCfg.style}`;

                document.getElementById('break-btn').style.display = progress >= 100 ? 'block' : 'none';
            },

            breakthrough() {
                this.triggerLightning(true);
                setTimeout(() => {
                    const r = this.realms[this.state.realmIdx];
                    if (Math.random() <= r.chance) {
                        this.state.realmIdx++;
                        this.state.qi = 0;
                        this.addLog(`<span class="text-green-400">SUCCESS! You have reached ${this.realms[this.state.realmIdx].name}</span>`);
                    } else {
                        this.state.qi *= 0.4;
                        this.addLog(`<span class="text-red-500">FAILURE! The Tribulation lightning has damaged your cultivation.</span>`);
                    }
                    this.triggerLightning(false);
                }, 1500);
            },

            triggerLightning(active) {
                const canvas = document.getElementById('lightning-canvas');
                const path = document.getElementById('lightning-path');
                if (active) {
                    canvas.classList.add('lightning-active');
                    this.lightningInterval = setInterval(() => {
                        let pts = "M 50 0 ";
                        for(let i=1; i<5; i++) pts += `L ${40 + Math.random()*20} ${i*20} `;
                        pts += "L 50 100";
                        path.setAttribute('d', pts);
                    }, 50);
                } else {
                    canvas.classList.remove('lightning-active');
                    clearInterval(this.lightningInterval);
                }
            },

            manualMeditate() {
                this.state.qi += (this.state.realmIdx + 1) * 10;
                this.render();
            },

            addLog(msg) {
                const l = document.getElementById('log');
                l.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + l.innerHTML;
            },

            setupDraggable() {
                const el = document.getElementById('admin-panel');
                const header = document.getElementById('admin-header');
                let x = 0, y = 0, mx = 0, my = 0;
                header.onmousedown = (e) => {
                    mx = e.clientX; my = e.clientY;
                    document.onmousemove = (e) => {
                        x = mx - e.clientX; y = my - e.clientY;
                        mx = e.clientX; my = e.clientY;
                        el.style.top = (el.offsetTop - y) + "px";
                        el.style.left = (el.offsetLeft - x) + "px";
                    };
                    document.onmouseup = () => { document.onmousemove = null; };
                };
            }
        };

        window.game = game;
        game.init();
    </script>
</body>
</html>
