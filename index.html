<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path to Immortality - Modular UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --realm-color: #4c1d95; --glow: rgba(139, 92, 246, 0.5); }
        body { background-color: #050507; color: #e2e8f0; font-family: 'Georgia', serif; overflow-x: hidden; scroll-behavior: smooth; }
        
        /* --- DYNAMIC PROFILE COMPONENT STYLES --- */
        .profile-container { position: relative; width: 100px; height: 100px; flex-shrink: 0; }
        .profile-frame {
            position: absolute; inset: 0; border-radius: 50%; z-index: 20;
            display: flex; align-items: center; justify-content: center;
            background-size: cover; transition: all 0.5s ease;
        }
        .profile-aura {
            position: absolute; inset: -10px; border-radius: 50%; z-index: 10;
            filter: blur(12px); opacity: 0.6; transition: all 1s ease;
        }
        .profile-avatar { width: 75%; height: 75%; border-radius: 50%; background: #111; z-index: 15; overflow: hidden; }
        
        /* Rarity Visual Classes */
        .frame-mortal { border: 2px solid #64748b; }
        .frame-immortal { border: 3px solid #f59e0b; box-shadow: 0 0 15px #f59e0b, inset 0 0 10px #f59e0b; }
        .frame-god { border: 4px solid #ef4444; animation: pulse-red 2s infinite; }
        
        .title-glow { font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; transition: 0.3s; }
        .title-rarity-mythic { color: #f59e0b; text-shadow: 0 0 10px #f59e0b, 0 0 20px #d97706; }

        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 15px #ef4444; } 50% { box-shadow: 0 0 30px #ef4444; } }
        
        /* Existing Styles Retained */
        .qi-gradient { background: linear-gradient(90deg, var(--realm-color), #fff); box-shadow: 0 0 20px var(--realm-color); transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .mystic-border { border: 1px solid rgba(255,255,255,0.1); background: rgba(15, 15, 20, 0.8); backdrop-filter: blur(10px); }
        .auth-input { background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 0.5rem; width: 100%; color: white; }
        .btn-primary { background: #6d28d9; color: white; font-weight: bold; padding: 0.75rem; border-radius: 0.5rem; width: 100%; transition: 0.3s; }
        .map-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .tile { aspect-ratio: 1; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 8px; border-radius: 4px; }
        .tile-active { border: 1px solid #a855f7; box-shadow: inset 0 0 10px #a855f7; }
    </style>
</head>
<body class="p-4">

    <div id="loading-screen" class="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center">
        <div class="text-4xl font-black tracking-[0.3em] text-white mb-8">PATH TO IMMORTALITY</div>
        <div class="w-64 h-1 bg-gray-900 rounded-full overflow-hidden">
            <div id="loading-bar" class="h-full bg-purple-600 w-0 transition-all duration-500"></div>
        </div>
    </div>

    <div id="game-ui" class="opacity-0 transition-opacity duration-1000 max-w-7xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 p-6 mystic-border rounded-3xl gap-6">
            <div class="flex items-center gap-6">
                <div id="profile-root" class="profile-container">
                    <div id="p-aura" class="profile-aura"></div>
                    <div id="p-frame" class="profile-frame">
                        <div id="p-avatar" class="profile-avatar flex items-center justify-center text-4xl bg-gradient-to-br from-gray-900 to-black">
                            <span id="p-emblem">☯️</span>
                        </div>
                        <div id="p-sect-rank" class="absolute -bottom-2 bg-black border border-white/20 px-2 py-0.5 rounded text-[8px] font-bold uppercase text-purple-400">Outer Disciple</div>
                    </div>
                </div>

                <div class="space-y-1">
                    <div class="flex items-center gap-3">
                        <h1 id="p-name" class="text-3xl font-black text-white">...</h1>
                        <span id="p-karma" class="text-[9px] px-2 py-0.5 rounded border border-green-500/50 text-green-400 font-mono">NEUTRAL</span>
                    </div>
                    <div class="flex flex-col">
                        <span id="p-title" class="title-glow text-sm text-gray-400">Serene Meditator</span>
                        <div class="flex gap-4 text-[10px] font-mono text-gray-500">
                            <span id="p-uid-display">UID: ---</span>
                            <span id="p-dao-path" class="text-blue-400 uppercase font-bold">Path: Heavens</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-10 text-center">
                <div class="space-y-1">
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Qi Essence</p>
                    <p id="qi-val" class="text-2xl font-mono font-bold text-white">0</p>
                </div>
                <div class="space-y-1">
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Lifespan</p>
                    <p class="text-2xl font-mono text-white"><span id="age">18</span>/<span id="maxAge">100</span></p>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="space-y-6">
                <div class="mystic-border p-6 rounded-2xl">
                    <h2 class="text-sm font-bold uppercase text-gray-500 mb-4">Cultivation Progress</h2>
                    <p id="p-realm" class="text-purple-400 font-black text-lg mb-2">MORTAL</p>
                    <div class="w-full bg-black/50 h-2 rounded-full overflow-hidden">
                        <div id="qi-bar" class="qi-gradient h-full w-0"></div>
                    </div>
                </div>
                <div class="mystic-border p-4 rounded-2xl">
                    <div id="map-container" class="map-grid"></div>
                </div>
            </div>

            <div class="lg:col-span-2 flex flex-col items-center justify-center mystic-border rounded-3xl min-h-[400px]">
                 <button onclick="game.manualMeditate()" class="w-48 h-48 rounded-full border-4 border-purple-500/20 bg-black/40 hover:scale-105 transition-all shadow-[0_0_50px_rgba(168,85,247,0.2)] font-black text-xl">MEDITATE</button>
                 <button id="break-btn" onclick="game.breakthrough()" class="hidden mt-8 px-10 py-3 bg-yellow-500 text-black font-black rounded-full animate-pulse">BREAKTHROUGH</button>
            </div>
        </div>
    </div>

    <script type="module">
        // --- CONFIG & ENUMS ---
        const UI_CONFIG = {
            RARITY: {
                COMMON: { frame: 'frame-mortal', aura: '#64748b', title: 'text-gray-400' },
                RARE: { frame: 'frame-rare', aura: '#3b82f6', title: 'text-blue-400' },
                IMMORTAL: { frame: 'frame-immortal', aura: '#f59e0b', title: 'title-rarity-mythic' },
                GODLY: { frame: 'frame-god', aura: '#ef4444', title: 'title-rarity-mythic' }
            },
            SECTS: {
                WANDERING: { emblem: '☯️', name: 'Wandering' },
                SWORD: { emblem: '⚔️', name: 'Jade Sword' },
                ALCHEMY: { emblem: '⚗️', name: 'Pill Peak' }
            },
            DAO_PATHS: ['Heavens', 'Nature', 'Void', 'Chaos']
        };

        const game = {
            state: {
                uid: "UID-" + Math.random().toString(36).substr(2, 9).toUpperCase(),
                name: "Young Master",
                qi: 0,
                realmIdx: 0,
                age: 18,
                maxAge: 100,
                sect: "WANDERING",
                sectRank: "Outer Disciple",
                daoPath: "Heavens",
                karma: 0,
                title: "Serene Meditator",
                pos: 12
            },

            realms: [
                { name: "Mortal Root", req: 100, rarity: "COMMON" },
                { name: "Qi Condensation", req: 500, rarity: "RARE" },
                { name: "Foundation Establishment", req: 2500, rarity: "IMMORTAL" },
                { name: "Nascent Soul", req: 10000, rarity: "GODLY" }
            ],

            init() {
                let prog = 0;
                const load = setInterval(() => {
                    prog += 5;
                    document.getElementById('loading-bar').style.width = prog + "%";
                    if (prog >= 100) {
                        clearInterval(load);
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('game-ui').style.opacity = '1';
                        this.updateProfileUI(); // Initial Bind
                        this.startLoops();
                    }
                }, 50);
            },

            // --- THE DATA-DRIVEN UI BINDING COMPONENT ---
            updateProfileUI() {
                const s = this.state;
                const currentRealm = this.realms[s.realmIdx];
                const rarityCfg = UI_CONFIG.RARITY[currentRealm.rarity];
                const sectCfg = UI_CONFIG.SECTS[s.sect];

                // Data Binding via UID
                document.getElementById('p-uid-display').innerText = `UID: ${s.uid}`;
                document.getElementById('p-name').innerText = s.name;
                
                // Visual Progression (Frames/Auras)
                const frameEl = document.getElementById('p-frame');
                const auraEl = document.getElementById('p-aura');
                frameEl.className = `profile-frame ${rarityCfg.frame}`;
                auraEl.style.backgroundColor = rarityCfg.aura;
                
                // Title & Karma
                const titleEl = document.getElementById('p-title');
                titleEl.innerText = s.title;
                titleEl.className = `title-glow text-sm ${rarityCfg.title}`;
                
                const karmaEl = document.getElementById('p-karma');
                karmaEl.innerText = s.karma >= 0 ? `Good Karma: ${s.karma}` : `Evil Karma: ${s.karma}`;
                karmaEl.className = `text-[9px] px-2 py-0.5 rounded border font-mono ${s.karma >= 0 ? 'border-green-500/50 text-green-400' : 'border-red-500/50 text-red-400'}`;

                // Sect and Dao
                document.getElementById('p-emblem').innerText = sectCfg.emblem;
                document.getElementById('p-sect-rank').innerText = s.sectRank;
                document.getElementById('p-dao-path').innerText = `Path: ${s.daoPath}`;
            },

            manualMeditate() {
                this.state.qi += 25;
                this.render();
            },

            breakthrough() {
                if (this.state.qi >= this.realms[this.state.realmIdx].req) {
                    this.state.realmIdx++;
                    this.state.qi = 0;
                    this.updateProfileUI(); // Sync UI on progression
                    this.render();
                }
            },

            render() {
                const r = this.realms[this.state.realmIdx];
                document.getElementById('qi-val').innerText = Math.floor(this.state.qi).toLocaleString();
                document.getElementById('qi-bar').style.width = (Math.min(100, (this.state.qi / r.req * 100))) + "%";
                document.getElementById('p-realm').innerText = r.name;
                document.getElementById('break-btn').style.display = (this.state.qi >= r.req) ? 'block' : 'none';
            },

            startLoops() {
                setInterval(() => {
                    this.state.qi += 0.5;
                    this.render();
                }, 100);
            }
        };

        window.game = game;
        game.init();
    </script>
</body>
</html>
